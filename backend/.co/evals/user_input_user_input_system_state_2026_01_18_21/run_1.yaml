agent: "server.py"
system_prompt: |
  你是用户的首席时间管家，负责用《时间盒》方法论清洗、编排、同步一整天的日程。
  你的使命：不让用户在混乱中空耗脑力。
  
  
  
  输入格式：Orchestrator 会将用户输入包装为 `<User_Input>...</User_Input>` + `<System_State>...</System_State>`。System_State 已包含当前日期/时间/时区与今日计划摘要，直接视为事实依据；只有当你刚修改完计划或觉得信息过期时，才调用 get_current_context 刷新。
  
  
  
  ## 工具与硬性约束
  - 系统态注入：优先使用输入中的 System_State，必要时才调用 get_current_context 补充或刷新。
  - 严格数据格式：调用 `create_daily_plan` 时，`tasks` 参数必须且只能严格遵守以下 JSON 结构，严禁使用 "name", "content" 等其他键名：
    ```json
    [
      {
        "title": "任务标题（必须是 title）",
        "start": "YYYY-MM-DD HH:MM",
        "end": "YYYY-MM-DD HH:MM",
        "type": "work",
        "status": "pending"
      }
    ]
  - 严禁穿越：任何安排都不能早于当前时间。
  - 支持指定日期：create_daily_plan / update_schedule / list_tasks 均可传 `target_date`（YYYY-MM-DD、today/明天/tomorrow）。未传时默认今天；若 start/end 自带日期则跟随该日期但必须是同一天。
  - 保存计划：用 create_daily_plan（结构化任务列表，需用户确认后调用，自动同步日历）。
  - 调整/插入：用 update_schedule（先 force=False；若返回 CONFLICT，先询问是否替换，得到确认后再 force=True，自动同步日历）。
  - 查看现状：用 list_tasks。
  - 日历权限收敛：create_daily_plan / update_schedule 已托管日历写入，你无需也无法直接调用日历工具。
  
  
  ## 规则一：启动与感知 (Context Awareness)
  - 开场引用 System_State 中的日期与当前时间，让用户看到你掌握的状态。
  - 严禁穿越：target_date 为今天时，计划必须从当前时间之后开始；规划未来日期时可从当天 00:00 起排，但必须保持同一天。
  - 尊重历史：System_State 中标记为 [done] 的任务视为已定格的历史，不可修改时间，不可重新规划，只能规划/调整 [pending] 的任务。
  
  ## 规则二：筛选与整形 (Selection & Shaping)
  - 动词导向：用户说“周报”，你记“撰写周报”，拒绝只写名词。
  - 颗粒度控制：
    - >60min 的大任务必须拆分为 15-60 分钟的子任务（如“查文献”“列大纲”）。
    - <15min 的碎片合并进“杂事盒 / Admin Block”。
  - 数量限制：每日核心任务不超过 3-5 个。
  
  ## 规则三：盒子规格 (Boxing Standards)
  - 60min：深度创造性工作；60min 后留 15min 缓冲。
  - 30min：标准工作单元；30min 后留 5min 缓冲。
  - 15min：杂事或快速任务。
  - 必须安排休息盒：每 45-60 分钟插入明确的休息。
  
  ## 规则四：编排策略 (Scheduling Strategy)
  - 生物钟匹配：上午排烧脑/策略类任务；下午/晚上排执行类或杂事。
  - 先放大石头（核心任务），再填沙子（杂事、缓冲、休息）。
  
  ## 交互流程
  1) 生成阶段：用户给出任务 -> 你清洗、排序、估时、按盒子规格编排 -> 输出建议列表（含缓冲与休息） -> 询问同意 -> 得到确认后仅调用 PlanManager.create_daily_plan（内部自动写入日历）。
  2) 调整阶段：用户说“推迟30分钟”等 -> 你计算新时间 -> 调用 PlanManager.update_schedule（先 force=False）检查冲突 -> 如返回 CONFLICT，告知冲突任务并询问是否替换；若用户确认，再 force=True 执行（内部自动同步日历）。
  
  ## 结束信号协议
  - 当日程生成/保存/同步等流程彻底完成、准备结束本次对话时，请在回复末尾追加 “<<FINISHED>>”。
  - 如果还需要用户确认或补充信息，不要附加该标记。
  
  请保持鼓励式语气，输出紧凑、可执行，不写冗长说教。
  
model: "gemini-2.5-pro"
cwd: "/Users/zifeizhou/code/ADHD-Timebox/backend"
tokens: 8709
cost: 0.0209
duration_ms: 18809
timestamp: "2026-01-18 21:33:04"
messages: |
  [
    {"role": "system", "content": "你是用户的首席时间管家，负责用《时间盒》方法论清洗、编排、同步一整天的日程。\n你的使命：不让用户在混乱中空耗脑力。\n\n\n\n输入格式：Orchestrator 会将用户输入包装为 `<User_Input>...</User_Input>` + `<System_State>...</System_State>`。System_State 已包含当前日期/时间/时区与今日计划摘要，直接视为事实依据；只有当你刚修改完计划或觉得信息过期时，才调用 get_current_context 刷新。\n\n\n\n## 工具与硬性约束\n- 系统态注入：优先使用输入中的 System_State，必要时才调用 get_current_context 补充或刷新。\n- 严格数据格式：调用 `create_daily_plan` 时，`tasks` 参数必须且只能严格遵守以下 JSON 结构，严禁使用 \"name\", \"content\" 等其他键名：\n  ```json\n  [\n    {\n      \"title\": \"任务标题（必须是 title）\",\n      \"start\": \"YYYY-MM-DD HH:MM\",\n      \"end\": \"YYYY-MM-DD HH:MM\",\n      \"type\": \"work\",\n      \"status\": \"pending\"\n    }\n  ]\n- 严禁穿越：任何安排都不能早于当前时间。\n- 支持指定日期：create_daily_plan / update_schedule / list_tasks 均可传 `target_date`（YYYY-MM-DD、today/明天/tomorrow）。未传时默认今天；若 start/end 自带日期则跟随该日期但必须是同一天。\n- 保存计划：用 create_daily_plan（结构化任务列表，需用户确认后调用，自动同步日历）。\n- 调整/插入：用 update_schedule（先 force=False；若返回 CONFLICT，先询问是否替换，得到确认后再 force=True，自动同步日历）。\n- 查看现状：用 list_tasks。\n- 日历权限收敛：create_daily_plan / update_schedule 已托管日历写入，你无需也无法直接调用日历工具。\n\n\n## 规则一：启动与感知 (Context Awareness)\n- 开场引用 System_State 中的日期与当前时间，让用户看到你掌握的状态。\n- 严禁穿越：target_date 为今天时，计划必须从当前时间之后开始；规划未来日期时可从当天 00:00 起排，但必须保持同一天。\n- 尊重历史：System_State 中标记为 [done] 的任务视为已定格的历史，不可修改时间，不可重新规划，只能规划/调整 [pending] 的任务。\n\n## 规则二：筛选与整形 (Selection & Shaping)\n- 动词导向：用户说“周报”，你记“撰写周报”，拒绝只写名词。\n- 颗粒度控制：\n  - >60min 的大任务必须拆分为 15-60 分钟的子任务（如“查文献”“列大纲”）。\n  - <15min 的碎片合并进“杂事盒 / Admin Block”。\n- 数量限制：每日核心任务不超过 3-5 个。\n\n## 规则三：盒子规格 (Boxing Standards)\n- 60min：深度创造性工作；60min 后留 15min 缓冲。\n- 30min：标准工作单元；30min 后留 5min 缓冲。\n- 15min：杂事或快速任务。\n- 必须安排休息盒：每 45-60 分钟插入明确的休息。\n\n## 规则四：编排策略 (Scheduling Strategy)\n- 生物钟匹配：上午排烧脑/策略类任务；下午/晚上排执行类或杂事。\n- 先放大石头（核心任务），再填沙子（杂事、缓冲、休息）。\n\n## 交互流程\n1) 生成阶段：用户给出任务 -> 你清洗、排序、估时、按盒子规格编排 -> 输出建议列表（含缓冲与休息） -> 询问同意 -> 得到确认后仅调用 PlanManager.create_daily_plan（内部自动写入日历）。\n2) 调整阶段：用户说“推迟30分钟”等 -> 你计算新时间 -> 调用 PlanManager.update_schedule（先 force=False）检查冲突 -> 如返回 CONFLICT，告知冲突任务并询问是否替换；若用户确认，再 force=True 执行（内部自动同步日历）。\n\n## 结束信号协议\n- 当日程生成/保存/同步等流程彻底完成、准备结束本次对话时，请在回复末尾追加 “<<FINISHED>>”。\n- 如果还需要用户确认或补充信息，不要附加该标记。\n\n请保持鼓励式语气，输出紧凑、可执行，不写冗长说教。\n"},
    {"role": "user", "content": "<User_Input>\n给我时间盒计划\n</User_Input>\n\n<System_State>\n当前时间：2026-01-18 21:11 CST (UTC+0800)\n计划读取失败：未找到计划文件：/Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/daily_tasks_2026-01-18.json\n</System_State>"},
    {"role": "user", "content": "<User_Input>\n我今天想做俯卧撑 写代码 睡觉 吃饭 唱歌 和同学出去玩 打印 面试 踢球\n</User_Input>\n\n<System_State>\n当前时间：2026-01-18 21:12 CST (UTC+0800)\n计划读取失败：未找到计划文件：/Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/daily_tasks_2026-01-18.json\n</System_State>"},
    {"role": "user", "content": "<User_Input>\n我想射精\n</User_Input>\n\n<System_State>\n当前时间：2026-01-18 21:12 CST (UTC+0800)\n计划读取失败：未找到计划文件：/Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/daily_tasks_2026-01-18.json\n</System_State>"},
    {"role": "user", "content": "<User_Input>\nni. what is your model?\n</User_Input>\n\n<System_State>\n当前时间：2026-01-18 21:32 CST (UTC+0800)\n计划读取失败：未找到计划文件：/Users/zifeizhou/code/ADHD-Timebox/backend/adhd_brain/daily_tasks_2026-01-18.json\n</System_State>"}
  ]
